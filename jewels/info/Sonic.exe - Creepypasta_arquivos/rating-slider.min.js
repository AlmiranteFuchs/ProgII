/* 
 * GD Rating Slider
 * v3.0
 * 2021 dev4Press.com
 *
 * This script is based on the rangeslider.js script, and it borrows
 * several functions from it related to handle dragging functionality.
 *
 * https://github.com/andreruffert/rangeslider.js
 */

;(function($,window,document,undefined){"use strict";Number.isNaN=Number.isNaN||function(value){return typeof value==="number"&&value!==value};function tryParseFloat(str,defaultValue){var value=parseFloat(str);return Number.isNaN(value)?defaultValue:value}function ucfirst(str){return str.charAt(0).toUpperCase()+str.substr(1)}function delay(fn,wait){var args=Array.prototype.slice.call(arguments,2);return setTimeout(function(){return fn.apply(null,args)},wait)}function debounce(fn,debounceDuration){debounceDuration=debounceDuration||100;return function(){if(!fn.debouncing){var args=Array.prototype.slice.apply(arguments);fn.lastReturnVal=fn.apply(window,args);fn.debouncing=true}clearTimeout(fn.debounceTimeout);fn.debounceTimeout=setTimeout(function(){fn.debouncing=false},debounceDuration);return fn.lastReturnVal}}function isHidden(element){return element&&(element.offsetWidth===0||element.offsetHeight===0||element.open===false)}function getHiddenParentNodes(element){var parents=[],node=element.parentNode;while(isHidden(node)){parents.push(node);node=node.parentNode}return parents}function getDimension(element,key){var hiddenParentNodes=getHiddenParentNodes(element),hiddenParentNodesLength=hiddenParentNodes.length,inlineStyle=[],dimension=element[key];function toggleOpenProperty(element){if(typeof element.open!=="undefined"){element.open=element.open?false:true}}if(hiddenParentNodesLength){for(var i=0;i<hiddenParentNodesLength;i++){inlineStyle[i]=hiddenParentNodes[i].style.cssText;if(hiddenParentNodes[i].style.setProperty){hiddenParentNodes[i].style.setProperty("display","block","important")}else{hiddenParentNodes[i].style.cssText+=";display: block !important"}hiddenParentNodes[i].style.height="0";hiddenParentNodes[i].style.overflow="hidden";hiddenParentNodes[i].style.visibility="hidden";toggleOpenProperty(hiddenParentNodes[i])}dimension=element[key];for(var j=0;j<hiddenParentNodesLength;j++){hiddenParentNodes[j].style.cssText=inlineStyle[j];toggleOpenProperty(hiddenParentNodes[j])}}return dimension}var pluginName="gdRatingSlider",pluginIdentifier=0,defaults={classMain:"gd-rating-slider",classModHasRating:"__with-rating",classModHasRaterLabel:"__with-rater-label",classModHasMinMax:"__with-minmax",classModHasGrid:"__with-grid",classModHasLabel:"__with-label",classModHideHandle:"__without-handle",classModIsRTL:"__is-rtl",classAtMin:"__value-is-min",classAtMax:"__value-is-max",classPrefix:"gdrsld",classSuffixSlider:"__slider",classSuffixRater:"__rater",classSuffixRating:"__rating",classSuffixMinMax:"__minmax",classSuffixMin:"__min",classSuffixMax:"__max",classSuffixInner:"__inner",classSuffixHandle:"__handle",classSuffixLabel:"__label",classSuffixLabelEmpty:"__label_empty",classSuffixFill:"__fill",classSuffixGrid:"__grid",classSuffixGridLines:"__grid_lines",classSuffixGridNumbers:"__grid_numbers",classSuffixClearfix:"__clearfix",classSuffixDisabled:"__disabled",classSuffixActive:"__active",classGridNumber:"__grid-number",classGridLineUnit:"__grid-unit",classGridLineSubUnit:"__grid-subunit",class:"",theme:"default",rating:0,hideHandle:false,showLabel:true,showMinMax:true,showGrid:true,showRating:true,showRaterLabel:false,gridUnits:5,gridSubUnits:4,width:"auto",minWidth:"auto",maxWidth:"100%",responsive:true,responsiveCutoff:560,onInit:null,onChange:null,onSlide:null};function GDRS(element,options){this.el=element;this.$el=$(element);this.$elf=this.$el[0];this.id="js-"+pluginName+"-"+pluginIdentifier++;this._name=pluginName;this._defaults=defaults;this._metadata=this.$el.data();this.settings=$.extend({},defaults,options,this._metadata);this.dimension="width";this.direction="left";this.coordinate="x";this.init();if(this.settings.onInit&&typeof this.settings.onInit==="function"){this.settings.onInit(this.id)}}$.extend(GDRS.prototype,{init:function(){this.startEvent=["mousedown","touchstart","pointerdown"].join("."+this.id+" ")+"."+this.id;this.moveEvent=["mousemove","touchmove","pointermove"].join("."+this.id+" ")+"."+this.id;this.endEvent=["mouseup","touchend","pointerup"].join("."+this.id+" ")+"."+this.id;this.resizeEvent=["load","resize","orientationchange"].join("."+this.id+" ")+"."+this.id;this.calc={};this.input={min:tryParseFloat(this.$elf.getAttribute("min"),0),max:tryParseFloat(this.$elf.getAttribute("max"),100),step:tryParseFloat(this.$elf.getAttribute("step"),1)};this.input.value=tryParseFloat(this.$elf.value,this.input.min);this.input.range=this.input.max-this.input.min;this.target="#"+this.id+" ."+this.cls("Inner")+":not("+this.cls("Disabled")+")";this.hide();this.render();this.resize(false);this.handleDown=this.handleDown.bind(this);this.handleMove=this.handleMove.bind(this);this.handleEnd=this.handleEnd.bind(this);var $this=this;$(window).on(this.resizeEvent,debounce(function(){delay(function(){$this.resize(false)},200)},20));this.$el.on("change."+this.id,function(e,data){if(data&&data.origin===$this.id){return}var value=e.target.value,pos=$this.positionFromValue(value);$this.setPosition(pos)});$(document).on(this.startEvent,this.target,this.handleDown)},disable:function(){this.$el.prop("disabled",true);this.$inner.addClass(this.cls("Disabled"))},enable:function(){this.$el.prop("disabled",false);this.$inner.removeClass(this.cls("Disabled"))},update:function(){this.resize(false)},handleDown:function(e){e.preventDefault();if(this.$inner.hasClass(this.cls("Disabled"))){return}$(document).on(this.moveEvent,this.handleMove);$(document).on(this.endEvent,this.handleEnd);this.$inner.addClass(this.cls("Active"));if((" "+e.target.className+" ").replace(/[\n\t]/g," ").indexOf(this.cls("Handle"))>-1){return}var pos=this.relativePosition(e),rangePos=this.$inner[0].getBoundingClientRect()[this.direction],handlePos=this.positionFromNode(this.$handle[0])-rangePos,setPos=pos-this.calc.grab;if(pos>=handlePos&&pos<handlePos+this.handle){this.calc.grab=pos-handlePos}this.setPosition(setPos)},handleMove:function(e){e.preventDefault();var pos=this.relativePosition(e),setPos=pos-this.calc.grab;this.setPosition(setPos)},handleEnd:function(e){e.preventDefault();$(document).off(this.moveEvent,this.handleMove);$(document).off(this.endEvent,this.handleEnd);this.$inner.removeClass(this.cls("Active"));this.$el.trigger("change",{origin:this.id});if(this.settings.onChange&&typeof this.settings.onChange==="function"){this.settings.onChange(this.input.value,this.id)}},render:function(){var cls=[this.settings.classMain,this.settings.classPrefix+"-theme__"+this.settings.theme],sty=["width:"+this.settings.width,"min-width:"+this.settings.minWidth,"max-width:"+this.settings.maxWidth];if(this.settings.class!==""){cls.push(this.settings.class)}if(this.show("Rating")){cls.push(this.settings.classModHasRating)}if(this.show("MinMax")){cls.push(this.settings.classModHasMinMax)}if(this.show("Grid")){cls.push(this.settings.classModHasGrid)}if(this.show("Label")){cls.push(this.settings.classModHasLabel)}if(this.show("RaterLabel")){cls.push(this.settings.classModHasRaterLabel)}if(this.rtl()){cls.push(this.settings.classModIsRTL)}if(this.settings.hideHandle){cls.push(this.settings.classModHideHandle)}this.$wrapper=$('<div style="'+sty.join(";")+'" class="'+cls.join(" ")+'" id="'+this.id+'" />').insertAfter(this.$el);this.$slider=$('<div class="'+this.cls("Slider")+'" />');this.$inner=$('<div class="'+this.cls("Inner")+'" />');this.$handle=$('<div class="'+this.cls("Handle")+'" />');this.$label=$('<div class="'+this.cls("Label")+'">'+this.input.value+"</div>");this.$fill=$('<div class="'+this.cls("Fill")+'" />');this.$rater=$('<div class="'+this.cls("Rater")+'"><span>'+this.settings.rating+"</span></div>");this.$inner.prepend(this.$rater,this.$fill,this.$handle);this.$wrapper.prepend(this.$slider);if(this.show("Label")){this.$inner.prepend(this.$label)}if(this.show("Rating")){this.$wrapper.prepend('<div class="'+this.cls("Rating")+'">'+this.settings.rating+"</div>")}if(this.show("MinMax")){this.$slider.prepend('<div class="'+this.cls("MinMax")+'"><span class="'+this.cls("Min")+'">'+this.input.min+'</span><span class="'+this.cls("Max")+'">'+this.input.max+"</span></div>")}else if(this.show("Label")){this.$slider.prepend('<div class="'+this.cls("LabelEmpty")+'"></div>')}this.$slider.append(this.$inner);if(this.show("Grid")){this.$grid=$('<div class="'+this.cls("Grid")+'">'+this.grid()+"</div>");this.$slider.append(this.$grid)}},resize:function(triggerSlide){this.input.value=tryParseFloat(this.$elf.value,this.input.min);this.calc.parent=this.$el.parent().width();this.calc.handle=getDimension(this.$handle[0],"offset"+ucfirst(this.dimension));this.calc.range=getDimension(this.$inner[0],"offset"+ucfirst(this.dimension));this.calc.max=this.calc.range-this.calc.handle;this.calc.grab=this.calc.handle/2;this.calc.position=this.positionFromValue(this.input.value);this.calc.rater=this.positionFromValue(this.settings.rating);this.$rater[0].style[this.dimension]=this.calc.rater+this.calc.grab+"px";if(this.settings.responsive&&this.calc.parent>0&&this.settings.responsiveCutoff>0){if(this.calc.parent<=this.settings.responsiveCutoff){if(this.show("Rating")){this.$wrapper.removeClass(this.settings.classModHasRating);this.$wrapper.addClass(this.settings.classModHasRaterLabel)}}else{if(this.show("Rating")){this.$wrapper.addClass(this.settings.classModHasRating);if(!this.show("RaterLabel")){this.$wrapper.removeClass(this.settings.classModHasRaterLabel)}}}}if(this.show("Grid")){this.$grid.css({width:"calc(100% - "+this.calc.handle+"px)","margin-left":this.calc.handle/2+"px"});$("."+this.settings.classGridNumber,this.$wrapper).each(function(){var m=-$(this).outerWidth()/2;$(this).css("margin-left",m+"px")})}if(this.$elf.disabled){this.$inner.addClass(this.cls("Disabled"))}else{this.$inner.removeClass(this.cls("Disabled"))}this.setPosition(this.calc.position,triggerSlide)},hide:function(){this.$el.css({position:"absolute",width:"1px",height:"1px",overflow:"hidden",opacity:"0"}).addClass(this.id)},show:function(name){return this.settings["show"+name]},cls:function(name){return this.settings.classPrefix+this.settings["classSuffix"+name]},rtl:function(){return document.dir==="rtl"},cap:function(pos,min,max){if(pos<min){return min}if(pos>max){return max}return pos},grid:function(){var lines=[],numbers=[],i,j,val,pos,sub,valBig=Math.ceil(this.input.range/this.settings.gridUnits),posBig=100/this.settings.gridUnits,posSmall=100/(this.settings.gridUnits*this.settings.gridSubUnits);for(i=0;i<=this.settings.gridUnits;i++){val=this.input.min+i*valBig;pos=i*posBig;numbers.push('<span class="'+this.settings.classGridNumber+'" style="left: '+pos+'%">'+val+"</span>");lines.push('<span class="'+this.settings.classGridLineUnit+'" style="left: '+pos+'%"></span>');if(i<this.settings.gridUnits){for(j=1;j<this.settings.gridSubUnits;j++){sub=(i*this.settings.gridSubUnits+j)*posSmall;lines.push('<span class="'+this.settings.classGridLineSubUnit+'" style="left: '+sub+'%"></span>')}}}return'<div class="'+this.cls("GridLines")+'">'+lines.join("")+'</div><div class="'+this.cls("GridNumbers")+'">'+numbers.join("")+"</div>"},setPosition:function(pos,triggerSlide){var value,newPos;if(triggerSlide===undefined){triggerSlide=true}value=this.valueFromPosition(this.cap(pos,0,this.calc.max));newPos=this.positionFromValue(value);if(value===this.input.min){this.$wrapper.addClass(this.settings.classAtMin)}else{this.$wrapper.removeClass(this.settings.classAtMin)}if(value===this.input.max){this.$wrapper.addClass(this.settings.classAtMax)}else{this.$wrapper.removeClass(this.settings.classAtMax)}this.$fill[0].style[this.dimension]=newPos+this.calc.grab+"px";this.$handle[0].style[this.direction]=newPos+"px";this.$label[0].style[this.direction]=newPos+this.calc.grab+"px";$(this.$label[0]).html(value);var m=-$(this.$label[0]).outerWidth()/2;$(this.$label[0]).css("margin-left",m+"px");this.setValue(value);this.calc.position=newPos;this.input.value=value;if(triggerSlide&&this.settings.onSlide&&typeof this.settings.onSlide==="function"){this.settings.onSlide(this.input.value,this.id)}},positionFromNode:function(node){var i=0;while(node!==null){i+=node.offsetLeft;node=node.offsetParent}return i},relativePosition:function(e){var ucCoordinate=ucfirst(this.coordinate),rangePos=this.$inner[0].getBoundingClientRect()[this.direction],pageCoordinate=0;if(typeof e.originalEvent["client"+ucCoordinate]!=="undefined"){pageCoordinate=e.originalEvent["client"+ucCoordinate]}else if(e.originalEvent.touches&&e.originalEvent.touches[0]&&typeof e.originalEvent.touches[0]["client"+ucCoordinate]!=="undefined"){pageCoordinate=e.originalEvent.touches[0]["client"+ucCoordinate]}else if(e.currentPoint&&typeof e.currentPoint[this.coordinate]!=="undefined"){pageCoordinate=e.currentPoint[this.coordinate]}return pageCoordinate-rangePos},positionFromValue:function(value){var percentage=(value-this.input.min)/(this.input.max-this.input.min);return!Number.isNaN(percentage)?percentage*this.calc.max:0},valueFromPosition:function(pos){var percentage=pos/(this.calc.max||1),value=this.input.step*Math.round(percentage*(this.input.max-this.input.min)/this.input.step)+this.input.min;return Number(value.toFixed(this.toFixed))},setValue:function(value){if(value===this.input.value&&this.$elf.value!==""){return}this.$el.val(value).trigger("input",{origin:this.id})}});$.fn[pluginName]=function(options,name,value){if(options===undefined||typeof options==="object"){return this.each(function(){if(!$.data(this,"plugin_"+pluginName)){$.data(this,"plugin_"+pluginName,new GDRS(this,options))}})}else if(typeof options==="string"){if(options==="enable"||options==="disable"||options==="update"){this.each(function(){if($.data(this,"plugin_"+pluginName)){var obj=$.data(this,"plugin_"+pluginName);obj[options]()}})}}}})(jQuery,window,document);
